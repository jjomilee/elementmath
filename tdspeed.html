<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê³±ì…ˆ ì—°ìŠµ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg1: #e0f7fa;
      --bg2: #80deea;
      --accent: #00796b;
      --accent-dim: #00695c;
      --text: #333;
      --panel: #ffffffcc;
      --panel-strong: #e6fffb;
      --wrong-bg: #fff4e6;
      --ok: #0a8a0a;
      --bad: #c0392b;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Comic Sans MS', 'Arial', sans-serif;
      background: linear-gradient(to bottom right, var(--bg1), var(--bg2));
      color: var(--text);
      margin: 0;
      padding: 20px 12px 64px;
      text-align: center;
    }

    h1 { font-size: 1.8rem; margin: 0 0 6px; }
    .sub { opacity: .9; margin-top: 4px; font-size: .95rem; }

    /* ===== ê³µí†µ ë°•ìŠ¤ ===== */
    .box {
      max-width: 940px;
      margin: 14px auto;
      padding: 12px;
      background: var(--panel);
      border-radius: 14px;
      box-shadow: 0 6px 16px #0002;
    }
    .box.header { background: var(--panel-strong); }

    /* ===== ë°”(í•œ ì¤„, ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš©) ===== */
    .bar {
      margin: 6px auto;
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      background: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 2px 6px #0001;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .bar > * { flex: 0 0 auto; white-space: nowrap; }

    .label { font-weight: 700; }

    /* ì…ë ¥ */
    #problemCount {
      width: 80px; text-align: center; font-size: 1rem; padding: 6px 8px;
      border: 2px solid #aaa; border-radius: 10px; transition: .2s;
    }
    #problemCount:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px #00796b22; }

    /* ë²„íŠ¼ */
    button {
      font-size: .95rem; padding: 8px 14px; border-radius: 10px; border: none;
      background: var(--accent); color: #fff; cursor: pointer; box-shadow: 0 2px 6px #0001;
      transition: background .2s; white-space: nowrap;
    }
    button:hover { background: var(--accent-dim); }
    button:disabled { background: #a7d7d3; cursor: not-allowed; }

    /* ===== ìë¦¬ìˆ˜ í† ê¸€(ì„¸ê·¸ë¨¼íŠ¸) ===== */
    .seg {
      display: inline-flex; gap: 0; border-radius: 10px; overflow: hidden; border: 2px solid #ddd;
    }
    .seg input { position: absolute; opacity: 0; pointer-events: none; }
    .seg label {
      padding: 8px 12px; font-weight: 700; cursor: pointer; user-select: none;
      background: #fafafa; border-right: 1px solid #ddd; transition: background .15s, color .15s;
    }
    .seg label:last-child { border-right: 0; }
    .seg input:checked + label { background: var(--accent); color: #fff; }
    .seg label:hover { background: #f1f1f1; }

    /* ìƒíƒœ í‘œì‹œ ì•Œì•½ */
    .pill {
      background: var(--panel); border-radius: 999px; padding: 8px 12px;
      box-shadow: 0 0 6px #ccc; font-weight: 700; font-size: .95rem; white-space: nowrap;
    }

    #timer { font-variant-numeric: tabular-nums; }

    /* ===== ë¬¸ì œ ì‹œíŠ¸: ëª¨ë°”ì¼ì—ì„œë„ 1ì¤„ ìœ ì§€ ===== */
    .sheet {
      max-width: 940px; margin: 0 auto; background: #fff; padding: 10px;
      border-radius: 14px; box-shadow: 0 8px 18px #0002; text-align: center;
    }
    .row {
      display: inline-flex;
      align-items: center; justify-content: center;
      gap: 10px; padding: 8px 6px; border-bottom: 1px dashed #eee; width: 100%;
    }
    .row:last-child { border-bottom: none; }
    .row-inner { display: inline-flex; align-items: center; gap: 10px; white-space: nowrap; margin: 0 auto; }

    .q { font-size: 1.3rem; color: #222; }
    .eq { font-size: 1.2rem; font-weight: 700; margin: 0 4px; }

    .ans { width: 110px; max-width: 30vw; text-align: center; font-size: 1.05rem; padding: 8px 10px; border-radius: 10px; border: 2px solid #aaa; outline: none; }
    .ans:focus { border-color: var(--accent); box-shadow: 0 0 0 3px #00796b22; }

    .mark { width: 40px; text-align: center; font-size: 1.2rem; font-weight: 700; }
    .mark.ok { color: var(--ok); }
    .mark.bad { color: var(--bad); }

    #result { font-size: 1rem; margin: 12px 0 6px; font-weight: bold; }

    #wrongList { margin-top: 14px; background: var(--wrong-bg); padding: 10px 12px; border-radius: 10px; box-shadow: 0 0 4px #ccc; max-width: 940px; margin-left:auto; margin-right:auto; }
    #wrongList h3 { margin: 0 0 6px; font-size: 1rem; }
    .wrong-item { font-size: .92rem; margin: 4px 0; }

    .footer { margin-top: 18px; }
    .back { display: inline-block; margin-top: 12px; color: #0077cc; text-decoration: none; font-size: .9rem; }

    @media (max-width: 420px) {
      h1 { font-size: 1.6rem; }
      .q { font-size: 1.15rem; }
      .ans { width: 90px; padding: 6px 8px; font-size: 1rem; }
      .mark { width: 36px; font-size: 1.1rem; }
    }
  </style>
</head>
<body>
  <h1>âœ–ï¸ ê³±ì…ˆ ì—°ìŠµ</h1>
  <div class="sub">í”¼ìŠ¹ìˆ˜ì™€ ìŠ¹ìˆ˜ì˜ <strong>ìë¦¬ìˆ˜</strong>ë¥¼ ì„ íƒí•´ ë¬¸ì œë¥¼ ë§Œë“¤ê³ , <strong>ê±¸ë¦° ì‹œê°„</strong>ê³¼ <strong>ì •ë‹µ/ì˜¤ë‹µ</strong>ì„ í™•ì¸í•˜ì„¸ìš”.</div>

  <!-- ìƒë‹¨ ë°•ìŠ¤: ì„¤ì •/ë™ì‘ -->
  <div class="box header controls-box">
    <!-- ì¤„1: í”¼ìŠ¹ìˆ˜/ìŠ¹ìˆ˜ ìë¦¬ìˆ˜ + ë¬¸ì œìˆ˜ + ì´ˆê¸°í™” -->
    <div class="bar" id="bar-setup">
      <span class="label">í”¼ìŠ¹ìˆ˜(ì•)</span>
      <div class="seg" role="tablist" aria-label="í”¼ìŠ¹ìˆ˜ ìë¦¬ìˆ˜">
        <input type="radio" name="digitsA" id="a1" value="1" checked><label for="a1">1ìë¦¬</label>
        <input type="radio" name="digitsA" id="a2" value="2"><label for="a2">2ìë¦¬</label>
        <input type="radio" name="digitsA" id="a3" value="3"><label for="a3">3ìë¦¬</label>
      </div>

      <span class="label">ìŠ¹ìˆ˜(ë’¤)</span>
      <div class="seg" role="tablist" aria-label="ìŠ¹ìˆ˜ ìë¦¬ìˆ˜">
        <input type="radio" name="digitsB" id="b1" value="1" checked><label for="b1">1ìë¦¬</label>
        <input type="radio" name="digitsB" id="b2" value="2"><label for="b2">2ìë¦¬</label>
        <input type="radio" name="digitsB" id="b3" value="3"><label for="b3">3ìë¦¬</label>
      </div>

      <span class="label">ë¬¸ì œ ìˆ˜</span>
      <input type="number" id="problemCount" min="1" max="50" value="10" />
      <button id="resetBtn">ì´ˆê¸°í™”</button>
    </div>

    <!-- ì¤„2: ìƒˆ ë¬¸ì œ ë§Œë“¤ê¸° + ì±„ì í•˜ê¸° -->
    <div class="bar" id="bar-actions">
      <button id="newSetBtn">ìƒˆ ë¬¸ì œ ë§Œë“¤ê¸°</button>
      <button id="gradeBtn" disabled>ì±„ì í•˜ê¸° (Enter ê°€ëŠ¥)</button>
    </div>
  </div>

  <!-- í•˜ë‹¨ ë°•ìŠ¤: ìƒíƒœ í‘œì‹œ -->
  <div class="box status-box">
    <div class="bar" id="bar-count-time">
      <div class="pill">ë¬¸ì œ ìˆ˜: <strong id="count">0</strong></div>
      <div class="pill">ì‹œê°„: <strong id="timer">00:00.0</strong></div>
    </div>
    <div class="bar" id="bar-score">
      <div class="pill">ë§íŒ ê°œìˆ˜: <strong id="correct">0</strong></div>
      <div class="pill">í‹€ë¦° ê°œìˆ˜: <strong id="wrong">0</strong></div>
    </div>
  </div>

  <!-- ë¬¸ì œ ì‹œíŠ¸ -->
  <div class="sheet" id="sheet" aria-live="polite"></div>

  <div id="result"></div>

  <div id="wrongList" hidden>
    <h3>âŒ ì˜¤ë‹µ ëª©ë¡</h3>
    <div id="wrongItems"><p>ì•„ì§ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
  </div>

  <div class="footer">
    <a href="index.html" class="back">ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <script>
    // ===== ìƒíƒœ =====
    let problems = []; // { a, b, op:'Ã—', ans }
    let started = false, graded = false;
    let startTime = 0, timerId = null;
    let correct = 0, wrong = 0;
    let digitsA = 1; // í”¼ìŠ¹ìˆ˜ ìë¦¬ìˆ˜
    let digitsB = 1; // ìŠ¹ìˆ˜ ìë¦¬ìˆ˜

    // ===== ì—˜ë¦¬ë¨¼íŠ¸ =====
    const sheetEl = document.getElementById('sheet');
    const gradeBtn = document.getElementById('gradeBtn');
    const newSetBtn = document.getElementById('newSetBtn');
    const resetBtn = document.getElementById('resetBtn');
    const problemCountEl = document.getElementById('problemCount');

    const countEl = document.getElementById('count');
    const correctEl = document.getElementById('correct');
    const wrongEl = document.getElementById('wrong');
    const timerEl = document.getElementById('timer');
    const resultEl = document.getElementById('result');
    const wrongList = document.getElementById('wrongList');
    const wrongItems = document.getElementById('wrongItems');

    const aRadios = Array.from(document.querySelectorAll('input[name="digitsA"]'));
    const bRadios = Array.from(document.querySelectorAll('input[name="digitsB"]'));

    // ===== ìœ í‹¸ =====
    function fmt(ms){
      const total = Math.floor(ms);
      const m = Math.floor(total / 60000);
      const s = Math.floor((total % 60000) / 1000);
      const d = Math.floor((total % 1000) / 100);
      return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${d}`;
    }

    function startTimer(){
      startTime = Date.now();
      timerId = setInterval(()=>{ timerEl.textContent = fmt(Date.now() - startTime); }, 100);
    }
    function stopTimer(){ if(timerId){ clearInterval(timerId); timerId = null; } }

    function randByDigits(d){
      const min = d === 1 ? 1 : Math.pow(10, d-1);
      const max = Math.pow(10, d) - 1;
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function makeProblem(){
      const a = randByDigits(digitsA);
      const b = randByDigits(digitsB);
      const op = 'Ã—';
      const ans = a * b;
      return { a, b, op, ans };
    }

    // ê³±ì…ˆì€ êµí™˜ë²•ì¹™ ì„±ë¦½ â†’ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ (a,b)ë¥¼ ì •ë ¬í•´ì„œ í‚¤ ìƒì„±
    function uniqueKey(p){
      const x = Math.min(p.a, p.b);
      const y = Math.max(p.a, p.b);
      return `${x}Ã—${y}`;
    }

    // ===== ì„¸íŠ¸ ìƒì„±/ë Œë” =====
    function generateSet(){
      let n = parseInt(problemCountEl.value, 10);
      if(isNaN(n) || n < 1) n = 10;
      if(n > 50) n = 50;

      const seen = new Set();
      problems = [];
      while(problems.length < n){
        const p = makeProblem();
        const k = uniqueKey(p);
        if(!seen.has(k)) { seen.add(k); problems.push(p); }
      }

      correct = 0; wrong = 0; graded = false; started = false;
      countEl.textContent = problems.length;
      correctEl.textContent = correct;
      wrongEl.textContent = wrong;
      timerEl.textContent = '00:00.0';
      renderSheet();
      resultEl.textContent = '';
      wrongList.hidden = true;
      wrongItems.innerHTML = '<p>ì•„ì§ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      gradeBtn.disabled = false;

      const first = sheetEl.querySelector('input.ans');
      if(first){ first.focus(); }
    }

    function rowEl(p, idx){
      const row = document.createElement('div');
      row.className = 'row';
      const wrap = document.createElement('div');
      wrap.className = 'row-inner';

      const q = document.createElement('div');
      q.className = 'q';
      q.innerHTML = `${idx+1}. <strong>${p.a} ${p.op} ${p.b}</strong>`;

      const eq = document.createElement('span');
      eq.className = 'eq';
      eq.textContent = '=';

      const input = document.createElement('input');
      input.className = 'ans';
      input.type = 'number';
      input.inputMode = 'numeric';
      input.autocomplete = 'off';
      input.dataset.index = idx;
      input.addEventListener('input', handleStart);
      input.addEventListener('keydown', (e)=> handleEnterAdvance(e, idx));

      const mark = document.createElement('div');
      mark.className = 'mark';
      mark.id = `mark-${idx}`;

      wrap.appendChild(q);
      wrap.appendChild(eq);
      wrap.appendChild(input);
      wrap.appendChild(mark);
      row.appendChild(wrap);
      return row;
    }

    function renderSheet(){
      sheetEl.innerHTML = '';
      problems.forEach((p, idx)=> sheetEl.appendChild(rowEl(p, idx)));
    }

    // ===== íë¦„ ì œì–´ =====
    function handleStart(){ if(!started){ started = true; startTimer(); } }

    function handleEnterAdvance(e, idx){
      if(e.isComposing) return;
      if(e.key === 'Enter'){
        const inputs = sheetEl.querySelectorAll('input.ans');
        if(idx < inputs.length - 1){ inputs[idx+1].focus(); }
        else { grade(); }
      }
    }

    function grade(){
      if(graded) return;
      const inputs = sheetEl.querySelectorAll('input.ans');
      correct = 0; wrong = 0;
      const wrongListData = [];

      inputs.forEach((inp, i)=>{
        const val = Number(inp.value);
        const p = problems[i];
        const m = document.getElementById(`mark-${i}`);
        if(Number.isNaN(val)){
          m.textContent = 'âš '; m.title = 'ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”'; m.className = 'mark bad';
          wrong++; wrongListData.push({ idx: i+1, text: `${p.a} ${p.op} ${p.b}`, user: 'ë¯¸ì…ë ¥', ans: p.ans });
          return;
        }
        if(val === p.ans){ m.textContent = 'âœ“'; m.className = 'mark ok'; correct++; }
        else { m.textContent = 'âœ—'; m.className = 'mark bad'; wrong++; wrongListData.push({ idx: i+1, text: `${p.a} ${p.op} ${p.b}`, user: val, ans: p.ans }); }
        inp.disabled = true;
      });

      stopTimer();
      const elapsed = Date.now() - startTime;
      timerEl.textContent = fmt(elapsed);
      graded = true;

      correctEl.textContent = correct;
      wrongEl.textContent = wrong;

      resultEl.textContent = `ê²°ê³¼: ${problems.length}ë¬¸ì œ ì¤‘ ${correct}ê°œ ì •ë‹µ, ${wrong}ê°œ ì˜¤ë‹µ Â· ì‹œê°„ ${fmt(elapsed)}`;

      wrongList.hidden = wrongListData.length === 0;
      if(wrongListData.length === 0){
        wrongItems.innerHTML = '<p>ì˜¤ë‹µì´ ì—†ì–´ìš”. í›Œë¥­í•´ìš”! ğŸ‰</p>';
      } else {
        wrongItems.innerHTML = '';
        wrongListData.forEach(item=>{
          const div = document.createElement('div');
          div.className = 'wrong-item';
          div.textContent = `${item.idx}. ${item.text} â†’ ë‚´ ë‹µ: ${item.user}, ì •ë‹µ: ${item.ans}`;
          wrongItems.appendChild(div);
        });
      }

      gradeBtn.disabled = true;
    }

    function resetAll(){
      stopTimer(); started = false; graded = false; problems = [];
      sheetEl.innerHTML = '';
      countEl.textContent = '0';
      correctEl.textContent = '0';
      wrongEl.textContent = '0';
      timerEl.textContent = '00:00.0';
      resultEl.textContent = '';
      wrongList.hidden = true;
      wrongItems.innerHTML = '<p>ì•„ì§ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      gradeBtn.disabled = true;
    }

    // ìë¦¬ìˆ˜ í† ê¸€ í•¸ë“¤ë§(ì„¸íŠ¸ ì¬ìƒì„±ì€ 'ìƒˆ ë¬¸ì œ ë§Œë“¤ê¸°'ì—ì„œ ìˆ˜í–‰)
    aRadios.forEach(r => r.addEventListener('change', (e)=>{ digitsA = Number(e.target.value) || 1; }));
    bRadios.forEach(r => r.addEventListener('change', (e)=>{ digitsB = Number(e.target.value) || 1; }));

    newSetBtn.addEventListener('click', generateSet);
    gradeBtn.addEventListener('click', grade);
    resetBtn.addEventListener('click', resetAll);

    // ì´ˆê¸° ì„¸íŠ¸ ìƒì„±
    generateSet();
  </script>
</body>
</html>
